let choiceArray = [
    "                                                            <div class=\"text-muted text-center mt-4\">点击这里选餐</div>",
    "                                                            <b class=\"title\">1区 自助餐</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂一楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-red\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    经常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">2区 套餐A</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂一楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">3区 套餐A</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂一楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">4区 套餐A</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">5区 套餐B</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">6区 盖浇饭</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-orange\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    有时扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">7区 套餐C</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">8区 面档</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-orange\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    有时扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>",
    "                                                            <b class=\"title\">9区 套餐B</b>\n" +
    "                                                            <span class=\"float-right\">\n" +
    "                                                                <span class=\"badge badge-orange\">\n" +
    "                                                                    已选餐\n" +
    "                                                                </span>\n" +
    "                                                            </span>\n" +
    "                                                            <br>\n" +
    "                                                            <small>\n" +
    "                                                                <span class=\"text-muted\">食堂二楼</span>\n" +
    "                                                            </small>\n" +
    "                                                            <div>\n" +
    "                                                                <i class=\"fa fa-exclamation-triangle icon-green\"></i>\n" +
    "                                                                <small class=\"mr-1\">\n" +
    "                                                                    不常扫描\n" +
    "                                                                </small>\n" +
    "                                                            </div>"
];

var choice = 0;
var on = 0;

function toDay() {
    let toD = getTo();
    let InpY = document.getElementById("year");
    let InpM = document.getElementById("month");
    let InpD = document.getElementById("day");
    InpY.value = toD.yr;
    InpM.value = toD.mo;
    InpD.value = toD.da;
    changeDate();
}

function changeDate() {
    let yr = parseInt(document.getElementById("year").value);
    let mon = parseInt(document.getElementById("month").value);
    let day = parseInt(document.getElementById("day").value);
    let d = new Date(yr + "/" + mon + "/" + day);
    let wkday = "周" + weekArray[d.getDay()];
    if (d.getDay() === undefined) {
        return;
    }
    let date = document.getElementById("1");
    date.innerHTML = mon + "/" + day + "<br>" + wkday;
}

function showChoice() {
    let chc = document.getElementById("chc");
    if (on === 0) {
        let ret = "";
        for (let i = 1; i <= 9; ++i) {
            ret += choiceModel;
            ret = ret.replace(/INDEX/g, 0);
            ret = ret.replace(/AREA/g, numArray[i]);
            ret = ret.replace(/FOOD/g, foodArray[i]);
            ret = ret.replace(/FLOOR/g, locArray[i]);
            ret = ret.replace(/LEVEL/g, levelArray[alertArray[i]]);
            ret = ret.replace(/FREQ/g, freqArray[alertArray[i]]);
            if (getUserInfo("name", getName(), "allow").includes(i) === false) {
                ret = ret.replace(/BUTINFO/g, butinfoArray[3]);
                ret = ret.replace(/BUTCLASS/g, butclassArray[3]);
            } else if (i === choice) {
                ret = ret.replace(/BUTINFO/g, butinfoArray[2]);
                ret = ret.replace(/BUTCLASS/g, butclassArray[2]);
            } else {
                ret = ret.replace(/BUTINFO/g, butinfoArray[1]);
                ret = ret.replace(/BUTCLASS/g, butclassArray[1]);
            }
        }
        chc.innerHTML = ret;
        on = 1;
    } else {
        chc.innerHTML = "";
        on = 0;
    }
}

function updateLook(v) {
    let shc = document.getElementById("shc");
    shc.innerHTML = choiceArray[v];
    showChoice();
}

function chooseType(a, tp) {
    choice = tp;
    updateLook(tp);
}

let gen = document.getElementById("gen");
gen.onclick = function () {
    let agr = document.getElementById("agree");
    let cook = getCookie("acc");
    let nam = decodeURI(cook.split("@")[0]);
    let ntyp = choice;
    let yr = parseInt(document.getElementById("year").value);
    let mon = parseInt(document.getElementById("month").value);
    let day = parseInt(document.getElementById("day").value);
    if (agr.checked === false) {
        gAlert("请先勾选复选框！");
    } else if (mon < 1 || mon > 12 || day < 1 || day > 31) {
        gAlert("请输入正确日期！");
    } else if (ntyp === 0) {
        gAlert("请在生成前选餐！");
    } else {
        let api = encodeDate(yr, mon, day) * 10 + ntyp;
        window.open("../result/print.html?" + api.toString(16));
    }
}